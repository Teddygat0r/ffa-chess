<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
        <link rel="stylesheet" href="main.css" />
    </head>
    <body>
        <div class="container">
            <dialog id="promotion">
                <div class="pr-box">
                    <div class="pr-item"><button onclick="promote('Queen')"><img src="assets/QueenW.png"/></button></div>
                    <div class="pr-item"><button onclick="promote('Rook')"><img src="assets/RookW.png"/></button></div>
                    <div class="pr-item"><button onclick="promote('Bishop')"><img src="assets/BishopW.png"/></button></div>
                    <div class="pr-item"><button onclick="promote('Knight')"><img src="assets/KnightW.png"/></button></div>
                </div>
            </dialog>
            <div class="chessboard">
                <div class="row">
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell light"
                        id="cell-0-0">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell dark"
                        id="cell-0-1">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell light"
                        id="cell-0-2">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell dark"
                        id="cell-0-3">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell light"
                        id="cell-0-4">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell dark"
                        id="cell-0-5">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell light"
                        id="cell-0-6">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell dark"
                        id="cell-0-7">
                        <img  />
                    </div>
                </div>
                <div class="row">
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell dark"
                        id="cell-1-0">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell light"
                        id="cell-1-1">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell dark"
                        id="cell-1-2">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell light"
                        id="cell-1-3">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell dark"
                        id="cell-1-4">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell light"
                        id="cell-1-5">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell dark"
                        id="cell-1-6">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell light"
                        id="cell-1-7">
                        <img  />
                    </div>
                </div>
                <div class="row">
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell light"
                        id="cell-2-0">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell dark"
                        id="cell-2-1">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell light"
                        id="cell-2-2">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell dark"
                        id="cell-2-3">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell light"
                        id="cell-2-4">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell dark"
                        id="cell-2-5">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell light"
                        id="cell-2-6">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell dark"
                        id="cell-2-7">
                        <img  />
                    </div>
                </div>
                <div class="row">
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell dark"
                        id="cell-3-0">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell light"
                        id="cell-3-1">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell dark"
                        id="cell-3-2">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell light"
                        id="cell-3-3">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell dark"
                        id="cell-3-4">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell light"
                        id="cell-3-5">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell dark"
                        id="cell-3-6">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell light"
                        id="cell-3-7">
                        <img  />
                    </div>
                </div>
                <div class="row">
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell light"
                        id="cell-4-0">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell dark"
                        id="cell-4-1">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell light"
                        id="cell-4-2">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell dark"
                        id="cell-4-3">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell light"
                        id="cell-4-4">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell dark"
                        id="cell-4-5">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell light"
                        id="cell-4-6">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell dark"
                        id="cell-4-7">
                        <img  />
                    </div>
                </div>
                <div class="row">
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell dark"
                        id="cell-5-0">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell light"
                        id="cell-5-1">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell dark"
                        id="cell-5-2">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell light"
                        id="cell-5-3">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell dark"
                        id="cell-5-4">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell light"
                        id="cell-5-5">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell dark"
                        id="cell-5-6">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell light"
                        id="cell-5-7">
                        <img  />
                    </div>
                </div>
                <div class="row">
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell light"
                        id="cell-6-0">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell dark"
                        id="cell-6-1">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell light"
                        id="cell-6-2">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell dark"
                        id="cell-6-3">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell light"
                        id="cell-6-4">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell dark"
                        id="cell-6-5">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell light"
                        id="cell-6-6">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell dark"
                        id="cell-6-7">
                        <img  />
                    </div>
                </div>
                <div class="row">
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell dark"
                        id="cell-7-0">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell light"
                        id="cell-7-1">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell dark"
                        id="cell-7-2">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell light"
                        id="cell-7-3">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell dark"
                        id="cell-7-4">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell light"
                        id="cell-7-5">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell dark"
                        id="cell-7-6">
                        <img  />
                    </div>
                    <div
                        ondrop="drop(event)"
                        ondragover="allowDrop(event)"
                        class="cell light"
                        id="cell-7-7">
                        <img  />
                    </div>
                </div>

                <!-- Add more rows here to create the chessboard -->
            </div>
        </div>

        

        <!-- remove-->
        <ul id="messages"></ul>
        <form id="form" action="">
            <input id="input" autocomplete="off" /><button>Send</button>
        </form>

        <script src="/socket.io/socket.io.js"></script>
        <script>
            var socket = io();

            var messages = document.getElementById("messages");
            var form = document.getElementById("form");
            var input = document.getElementById("input");
            var promotion = false;

            form.addEventListener("submit", function (e) {
                e.preventDefault();
                if (input.value) {
                    socket.emit("chat message", input.value);
                    input.value = "";
                }
            });
            
            socket.on("chat message", function (msg) {
                for (let i = 0; i < msg.length; i++) {
                    for (let j = 0; j < msg.length; j++) {
                        document
                            .getElementById(`cell-${7 - i}-${j}`)
                            .getElementsByTagName("img")[0].src =
                            "./assets/" +
                            (msg[i][j] ? msg[i][j].piece : " ") +
                            (msg[i][j] ? msg[i][j].color : " ").charAt(0) +
                            ".png";
                        document
                            .getElementById(`cell-${7 - i}-${j}`)
                            .getElementsByTagName("img")[0].style.visibility =
                            msg[i][j] ? "visible" : "hidden";
                        document
                            .getElementById(`cell-${7 - i}-${j}`)
                            .getElementsByTagName("img")[0].draggable =
                            msg[i][j] ? "true" : "false";
                        /*document.getElementById(`cell-${7 - i}-${j}`).style.color =
                            msg[i][j] ? msg[i][j].color : " ";*/
                    }
                }
            });

            socket.on("promotion", function(msg) {
                document.getElementById('promotion').show();
                promotion = true;
            });

            function promote(chr){
                if(promotion){
                    promotion = false;
                    socket.emit("promotion", chr);
                    document.getElementById('promotion').close();
                }

            }

            function drag(ev) {
                ev.dataTransfer.setData("text", ev.target.id);
            }
        </script>
    </body>
</html>
